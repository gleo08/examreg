{% extends 'layout.html' %}

{% block body %}
	<h1>Admin <small>Welcome {{ session.username }}</small></h1>

	<ul class="nav nav-tabs" id="myTab">
		<li class="active"><a data-toggle="tab" href="#makeContest">Make contest</a></li>
		<li><a data-toggle="tab" href="#subject">Subjects</a></li>
		<li><a data-toggle="tab" href="#account">Provide account</a></li>
		<li><a data-toggle="tab" href="#ss">Student Subject</a></li>
		<li><a data-toggle="tab" href="#shift">Shifts</a></li>
		<li><a data-toggle="tab" href="#room">Rooms</a></li>
		<li><a data-toggle="tab" href="#srs">Schedule</a></li>
  		<li><a data-toggle="tab" href="#result">Result</a></li>
	</ul>

	<div class="tab-content">

<!-- BEGIN MAKE CONTEST-->
		<div id="makeContest" class="tab-pane fade in active">
			<h2>Make Contest</h2>
			<fieldset>
				<div class="form-group">
					<input class="form-control" placeholder="Name Contest" id="nameContest" type="text">
				</div>
				<button class="btn btn-primary" id="submit">Confirm</button>
			</fieldset>
		</div>
<!-- END MAKE CONTEST -->

<!-- BEGIN SUBJECTS OF SEMESTER -->
		<div id="subject" class="tab-pane fade">
			<h2>Subjects of semester</h2>
			<form id="upload-file1" method="post" enctype="multipart/form-data">
				<fieldset>
					<label for="file">Select a file</label>
					<input type="file" name="file" >
				</fieldset>
				<br>
				<fieldset>
					<button type="button" id="submit1" class="btn btn-primary">Upload</button>
				</fieldset>
			</form>
			<br>
			<form id="formshow" style="display: none">
				<p><big>Show subjects:</big></p>
				<button type="button" id="show" class="btn btn-primary">Show</button>
			</form>
			<br>
			<table id="tb1" class="table table-hover" style="display: none">
					<thead class="thead-dark">
    					<tr>
        					<th scope="col">#</th>
        					<th scope="col">Subject Name</th>
							<th scope="col">Subject Code</th>
    					</tr>
					</thead>
						<tbody id="tdata1">

						</tbody>
			</table>
		</div>
<!-- END SUBJECTS OF SEMESTER -->

<!-- BEGIN STUDENT SUBJECT-->
		<div id="ss" class="tab-pane fade">
			<h2>Student Subject</h2>
			<div>
  				<label for="sel1">Select subject:</label>
  				<select class="form-control" id="sel">
  				</select>
				<br>
				<button type="button" id="choose" class="btn btn-primary">Confirm</button>
			</div>
			<br>
			<form id="upload-file2" method="post" enctype="multipart/form-data" style="display: none">
				<h3>Upload student list</h3>
				<fieldset>
					<label for="file">Select a file</label>
					<input type="file" name="file" >
				</fieldset>
				<br>
				<fieldset>
					<button type="button" id="submit2" class="btn btn-primary">Upload</button>
				</fieldset>
			</form>
		</div>
<!-- END STUDENT SUBJECT -->

<!-- BEGIN ACCOUNT -->
		<div id="account" class="tab-pane fade">
			<h2>Account of Students</h2>
			<form id="upload-file3" method="post" enctype="multipart/form-data">
				<fieldset>
					<label for="file">Select a file</label>
					<input type="file" name="file">
				</fieldset>
				<br>
				<fieldset>
					<button type="button" id="submit3" class="btn btn-primary">Upload</button>
				</fieldset>
			</form>
		</div>
<!-- END ACCOUNT -->

<!-- BEGIN SHIFT-->
		<div id="shift" class="tab-pane fade">
			<h2>Shift</h2>
			<table id="tb2" class="table table-hover">
					<thead class="thead-dark">
    					<tr>
        					<th scope="col">#</th>
        					<th scope="col">Date</th>
							<th scope="col">Name</th>
							<th scope="col">Begin time</th>
							<th scope="col">End time</th>
    					</tr>
					</thead>
						<tbody id="tdata2">

						</tbody>
			</table>
			<br>
			<button class="btn btn-primary" id="add1" name="add1">Add</button>
			<br>
			<br>
			<div class="form-group" id="formAddShift" style="display: none">
				<input class="form-control" placeholder="Date" id="date" type="text">
				<input class="form-control" placeholder="Name" id="shiftName" type="text">
				<input class="form-control" placeholder="Begin time" id="beginTime" type="text">
				<input class="form-control" placeholder="End time" id="endTime" type="text">
				<br>
				<button type="submit" id="submit4" class="btn btn-primary">Confirm</button>
			</div>
		</div>

<!-- END SHIFT -->

<!-- BEGIN Rooms -->
		<div id="room" class="tab-pane fade">
			<h2>Rooms</h2>
			<table id="tb3" class="table table-hover">
					<thead class="thead-dark">
    					<tr>
        					<th scope="col">#</th>
        					<th scope="col">Name</th>
							<th scope="col">Slots</th>
    					</tr>
					</thead>
						<tbody id="tdata3">

						</tbody>
			</table>
			<br>
			<button class="btn btn-primary" id="add2" name="add2">Add</button>
			<br>
			<br>
			<div class="form-group" id="formAddRoom" style="display: none">
				<input class="form-control" placeholder="Name" id="roomName" type="text">
				<input class="form-control" placeholder="Slots" id="slots" type="text">
				<br>
				<button type="submit" id="submit5" class="btn btn-primary">Confirm</button>
			</div>
		</div>
<!-- END Rooms -->

<!-- BEGIN Shchedule -->
	<div id="srs" class="tab-pane fade">
			<h2>Schedule</h2>
			<div>
  				<label for="sel">Select subject:</label>
  				<select class="form-control" id="sel4">
  				</select>
			</div>
			<br>
			<div>
				<label for="sel">Select date:</label>
				<select class="form-control" id="sel5">
					<option>Choose</option>
				</select>
			</div>
			<br>
			<div>
				<label for="sel">Select shift:</label>
				<select class="form-control" id="sel6">
					<option>Choose</option>
				</select>
			</div>
			<br>
			<div>
				<label for="sel">Select room:</label>
				<select class="form-control" id="sel7">
					<option>Choose</option>
				</select>
			</div>
			<br>
			<button type="button" id="confirm" class="btn btn-primary">Confirm</button>
		</div>
<!-- END Schedule -->

<!-- BEGIN Result -->
		<div id="result" class="tab-pane fade">
			<h2>Result</h2>
			<form id="select">
				<div>
  					<label for="sel1">Select subject:</label>
  					<select class="form-control" id="sel1">
  					</select>
				</div>
				<br>
				<div>
  					<label for="sel2">Select shift:</label>
  					<select class="form-control" id="sel2">
						<option>Choose</option>
  					</select>
				</div>
				<br>
				<div>
  					<label for="sel3">Select room:</label>
  					<select class="form-control" id="sel3">
						<option>Choose</option>
  					</select>
				</div>
				<br>
				<div>
					<button type="button" name="check" id="check" class="btn btn-primary">Check</button>
				</div>
				<br>
			</form>
			<form id="list" style="display: none">
				<table id="tb4" class="table table-hover">
						<thead class="thead-dark">
    						<tr>
        						<th scope="col">#</th>
        						<th scope="col">Student Name</th>
								<th scope="col">Date of Birth</th>
    						</tr>
						</thead>
							<tbody id="tdata4">

							</tbody>
				</table>
				<br>
				<div>
					<button type="button" name="save" id="save" class="btn btn-success">Save</button>
				</div>
				<br>
				<div>
					<button type="button" name="continue" id="continue" class="btn btn-primary">Continue</button>
				</div>
			</form>
		</div>

<!-- END Result -->
	</div>

<!-- Make Contest -->
	<script>
		$(document).ready(function(){
			$("#submit").click(function(){
				var name = $("#nameContest").val();
				console.log(name);
				var data =
					{
						nameContest: name
					};
				var respone = JSON.stringify(data);
				$.ajax({
            			type: "POST",
            			contentType: "application/json",
            			url: "http://127.0.0.1:5000/makeContest",
            			dataType: "json",
            			data: respone,
            			success: function (respone) {
               				if (respone.success){
               					alert("Success");
               					location.reload();
               				}
            			},
            			error: function () {
             				console.log("Error");
            			}
        		});
			});
		});
	</script>

<!-- END Make Contest -->

<!-- BEGIN Subjects of semester -->
	<script>
		$(document).ready(function(){
			$("#submit1").click(function(){
				var form_data = new FormData($("#upload-file1")[0]);
				$.ajax({
					type: "POST",
        			url: "http://127.0.0.1:5000/insertSubjects",
        			cache: false,
        			contentType: false,
        			processData: false,
        			data: form_data,
        			success: function(){
        				alert("Success");
        			},
        			error: function(){
        				console.log("Error");
        			}
     			});
     			$("#upload-file1").css("display", "none");
     			$("#formshow").removeAttr("style");
     		});
     	});
	</script>


	<script>
		$(document).ready(function(){
			$("#show").click(function(){
     			$.get("http://127.0.0.1:5000/getSubjects", function(data, status){
					var data = JSON.parse(data);
					var count = 1;
					var txt ="";
						data.forEach(function(dt){
							txt += "<tr><td>"+count+"</td><td>"+dt.name+"</td><td>"+dt.code+"</dt></tr>";
							console.log
							count++;
						});
					$("#tdata1").html(txt);
					$("#tb1").removeAttr('style');
				});
			});
		});
	</script>
<!-- END Subjects of semester -->

<!-- BEGIN Student subject -->
	<script>
		$(document).ready(function(){
			var txt = "<option value='-1'>Choose</option>";
			$.get("http://127.0.0.1:5000/getSubjects", function(data, status){
				var data = JSON.parse(data);
				data.forEach(function(dt){
					txt += "<option id='subject' value='"+dt.id+"'>"+dt.code+"("+dt.name+")"+"</option>";
				});
				$("#sel").html(txt);
			});
		});
	</script>

	<script>
		$(document).ready(function(){
			$("#sel").change(function(){
				$("#choose").click(function(){
					var i = $("#sel").val();
					console.log(i);
					$("#upload-file2").removeAttr("style");
						$("#submit2").click(function(){
							var form_data = new FormData($("#upload-file2")[0]);
							$.ajax({
								type: "POST",
        						url: "http://127.0.0.1:5000/insertSS/"+i,
        						cache: false,
        						contentType: false,
        						processData: false,
        						data: form_data,
        						success: function(){
        							alert("Success");
        							location.reload();
        						},
        						error: function(){
        							console.log("Error");
        						}
							});
						});
				});
			});
     	});
	</script>

<!-- END Student subject -->

<!-- BEGIN Account of Student -->
	<script>
		$(document).ready(function(){
			$("#submit3").click(function(){
				var form_data = new FormData($("#upload-file3")[0]);
				$.ajax({
					type: "POST",
        			url: "http://127.0.0.1:5000/insertUsers",
        			cache: false,
        			contentType: false,
        			processData: false,
        			data: form_data,
        			success: function(){
        					alert("Success");
        					location.reload();
        			},
     			});
     		});
     	});
	</script>
<!-- END Account of Student -->

<!-- BEGIN Shift -->
	<script>
		$(document).ready(function(){
			$.get("http://127.0.0.1:5000/getListOfTiming", function(data, status){
				var data = JSON.parse(data);
				var count = 1;
				data.forEach(function(dt){
					$("#tdata2").append("<tr>"+
							"<td>"+count+"</td>"+
							"<td>"+dt.date+"</td>"+
							"<td>"+dt.name+"</td>"+
							"<td>"+dt.begin_time+"</td>"+
							"<td>"+dt.end_time+"</td>"
							+"</tr>"
					);
					count++;
				});
			});
		});
	</script>

	<script>
		$(document).ready(function(){
			$("#add1").click(function(){
				$("#formAddShift").removeAttr("style");
			});
		});
	</script>

	<script>
		$(document).ready(function(){
			var txt = "<option value='-1'>Choose</option>";
			$("#submit4").click(function(){
				var i = $("#date").val();
				var j = $("#shiftName").val();
				var k = $("#beginTime").val();
				var l = $("#endTime").val();
				var data = {
					date: i,
					shiftName: j,
					beginTime: k,
					endTime: l
				}
				var result = JSON.stringify(data);
				$.ajax({
					type: "POST",
            		contentType: "application/json",
            		url: "http://127.0.0.1:5000/addTiming",
            		dataType: "json",
            		data: result,
           			success: function () {
						alert("Success");
						location.reload();
					},
					error: function() {
						alert("Error");
					}
				});
			});
		});
	</script>

<!-- END Shift -->

<!-- BEGIN Room -->
	<script>
		$(document).ready(function(){
			$.get("http://127.0.0.1:5000/getListOfRooms", function(data, status){
				var data = JSON.parse(data);
				var count = 1;
				data.forEach(function(dt){
					$("#tdata3").append("<tr>"+
							"<td>"+count+"</td>"+
							"<td>"+dt.name+"</td>"+
							"<td>"+dt.slots+"</td>"
							+"</tr>"
					);
					count++;
				});
			});
		});
	</script>

	<script>
		$(document).ready(function(){
			$("#add2").click(function(){
				$("#formAddRoom").removeAttr("style");
			});
		});
	</script>

	<script>
		$(document).ready(function(){
			var txt = "<option value='-1'>Choose</option>";
			$("#submit5").click(function(){
				var i = $("#roomName").val();
				var j = $("#slots").val();
				var data = {
					roomName: i,
					slots: j
				}
				var result = JSON.stringify(data);
				console.log(result);
				$.ajax({
					type: "POST",
            		contentType: "application/json",
            		url: "http://127.0.0.1:5000/addRoom",
            		dataType: "json",
            		data: result,
           			success: function () {
						alert("Success");
						location.reload();
					},
					error: function() {
						alert("Error");
					}
				});
			});
		});
	</script>
<!-- END Room -->

<!-- BEGIN Shift Room for Subject -->
	<script>
		$(document).ready(function(){
			var txt = "<option value='-1'>Choose</option>";
			$.get("http://127.0.0.1:5000/getSubjects", function(data, status){
				var data = JSON.parse(data);
				data.forEach(function(dt){
					txt += "<option id='subject' value='"+dt.id+"'>"+dt.code+"("+dt.name+")"+"</option>";
				});
				$("#sel4").html(txt);
			});
		});
	</script>

	<script>
		$(document).ready(function(){
			var txt = "<option value='-1'>Choose</option>";
			$.get("http://127.0.0.1:5000/getDate", function(data, status){
				var data = JSON.parse(data);
				data.forEach(function(dt){
					txt += "<option id='date' value='"+dt.date+"'>"+dt.date+"</option>";
				});
				$("#sel5").html(txt);
			});

		});
	</script>

	<script>
		$(document).ready(function(){
			var txt = "<option value='-1'>Choose</option>";
			$("#sel5").change(function(){
				var i = $("#sel5").val();
				$.get("http://127.0.0.1:5000/getShiftOfDate", function(data, status){
					var data = JSON.parse(data);
					data.forEach(function(dt){
						if (i == dt.date) {
							txt += "<option id='shift' value='"+dt.id+"'>"+dt.name+"("+dt.begin_time+" to "+dt.end_time+")"+"</option>";
						}
					});
					$("#sel6").html(txt);
				});
			});
		});
	</script>

	<script>
		$(document).ready(function() {
			var txt = "<option value='-1'>Choose</option>";
			$("#sel5").change(function() {
				$("#sel6").change(function() {
					$.get("http://127.0.0.1:5000/getRooms", function(data, status) {
						var data = JSON.parse(data);
						data.forEach(function(dt) {
							txt += "<option id='room' value='"+dt.id+"'>"+dt.name+"("+dt.slots+")"+"</option>";
						});
						$("#sel7").html(txt);
					});
				});
			});
		});
	</script>

	<script>
		$(document).ready(function() {
			$("#confirm").click(function() {
				var i = $("#sel4").val();
				var j = $("#sel5").val();
				var k = $("#sel6").val();
				var l = $("#sel7").val();
				if (i == -1){
					alert("Please choose subject");
				}
				if (j == -1){
					alert("Please choose date");
				}
				if (k == -1){
					alert("Please choose shift");
				}
				if (l == -1){
					alert("Please choose room");
				}
				else {
					var data = {
						timing_id: k,
						room_id: l,
						subject_id: i
					}
					result = JSON.stringify(data);
					$.ajax({
						type: "POST",
						contentType: "application/json",
            			url: "http://127.0.0.1:5000/insertTRS",
            			dataType: "json",
            			data: result,
            			success: function() {
            				alert("Success");
            				location.reload();
            			},
            			error: function() {
            				console.log("Error");
            			}
					});
				}
			});
		});
	</script>

<!-- END Shift Room for Sunject -->

<!-- BEGIN Result -->
	<script>
		$(document).ready(function(){
			var txt = "<option value='-1'>Choose</option>";
			$.get("http://127.0.0.1:5000/getSubjects", function(data, status){
				var data = JSON.parse(data);
				data.forEach(function(dt){
					txt += "<option id='subject' value='"+dt.id+"'>"+dt.code+"("+dt.name+")"+"</option>"
				});
				$("#sel1").html(txt);
			});
		});
	</script>

	<script>
		$(document).ready(function(){
			var txt = "<option value='-1'>Choose</option>";
			$("#sel1").change(function(){
				var i = $("#sel1").val();
				$.get("http://127.0.0.1:5000/timingOfSubjectAdmin", function(data, status){
					var data = JSON.parse(data);
					data.forEach(function(dt){
						if (i == dt.subject_id){
							txt += "<option id='shift' value='"+dt.timing_id+"'>"+dt.name+"("+dt.begin_time+" to "+dt.end_time+")"+"</option>";
						};
					});
					$("#sel2").html(txt);
				});
			});
		});
	</script>

	<script>
		$(document).ready(function(){
			var txt = "<option value='-1'>Choose</option>";
			$("#sel1").change(function(){
				var i = $("#sel1").val();
				$("#sel2").change(function(){
					var j = $("#sel2").val();
					$.get("http://127.0.0.1:5000/roomOfTimingSubjectAdmin", function(data, status){
						var data = JSON.parse(data);
						data.forEach(function(dt){
							if (i == dt.subject_id && j == dt.timing_id){
								txt += "<option id='room' value='"+dt.id+"'>"+dt.name+"</option>";
							};
						});
						$("#sel3").html(txt);
					});
				});
			});
		});
	</script>

	<script>
		$(document).ready(function() {
			$("#check").click(function() {
				var i = $("#sel1").val();
				var j = $("#sel2").val();
				var k = $("#sel3").val();
				if(i == -1){
					alert("Please choose subject");
				}
				else if(j == -1){
					alert("Please choose shift");
				}
				else if(k == -1){
					alert("Please choose room");
				}
				else {
					$.get("http://127.0.0.1:5000/registedAdmin", function(data, status){
						var data = JSON.parse(data);
						console.log(data);
						var count = 1;
						var txt ="";
							data.forEach(function(dt){
								txt += "<tr><td>"+count+"</td><td>"+dt.name+"</td><td>"+dt.date_of_birth+"</td></tr>";
								count++;
							});
							$("#tdata4").html(txt);
							$("#select").css("display", "none");
							$("#list").removeAttr("style");

					});
				}
			});
		});
	</script>

	<script>
		$(document).ready(function() {
			$("#continue").click(function() {
				location.reload();
			});
		});
	</script>
<!-- END Result -->

<!-- BEGIN Save -->
	<script>
    	$(document).ready(function() {
        	$('#save').click(function() {
            	console.log('print');
            	var printContents = $('#tb4').html();
            	var originalContents = $('body').html();
            	$('body').html(printContents);
            	window.print();
            	$('body').html(originalContents);
        	});
    	});
	</script>
<!-- END Save -->

<!-- Keep selected tab page refresh -->
	<script>
		$('#myTab a').click(function(e) {
  			e.preventDefault();
  			$(this).tab('show');
		});

		// store the currently selected tab in the hash value
		$("ul.nav-tabs > li > a").on("shown.bs.tab", function(e) {
  			var id = $(e.target).attr("href").substr(1);
  			window.location.hash = id;
		});

		// on load of the page: switch to the currently selected tab
		var hash = window.location.hash;
		$('#myTab a[href="' + hash + '"]').tab('show');
	</script>

{% endblock %}